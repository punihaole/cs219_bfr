#!/bin/bash

if [ $(id -u) = '0' ]; then
	echo "should not run as superuser!"
	exit 1
fi

if [ "$#" -ge '1' ]; then
	arg=$1
else
	arg="start"
fi	

if [ "$arg" != 'start' -a "$arg" != 'restart' -a "$arg" != 'stop' ]; then
	echo "unexpected command"
	exit 1
fi

if [ "$arg" = 'start' ]; then
	if [ "$(pidof ccnud)" ]; then
		echo " * ccnud already running"
	else
		echo " * Starting ccnud"
		if [ "$#" -ge '2' ]; then
			result=`~/projects/cs219_ccnumr/bin/ccnud $2`
			echo $result
		else
			result=`~/projects/cs219_ccnumr/bin/ccnud`
		fi
	fi

	sleep 0.5

	if [ "$(pidof ccnumrd)" ]; then
		echo " * ccnumrd already running"
	else
		echo " * Starting ccnumrd"
		if [ "$#" -ge '3' ]; then
			result=`~/projects/cs219_ccnumr/bin/ccnumrd $3`
		else
			result=`~/projects/cs219_ccnumr/bin/ccnumrd`
		fi
	fi

elif [ "$arg" = 'restart' ]; then
	if [ "$(pidof ccnud)" ]; then
		echo " * Shutting down ccnud"
		killall ccnud
	fi

	echo " * Starting ccnud"
	if [ "$#" -ge '2' ]; then
		result=`~/projects/cs219_ccnumr/bin/ccnud $2`
		echo $result
	else
		result=`~/projects/cs219_ccnumr/bin/ccnud`
	fi

	if [ "$(pidof ccnumrd)" ]; then
		echo " * Shutting down ccnumrd"
		killall ccnumrd
	fi

	sleep 1
	echo " * Starting ccnumrd"

	if [ "$#" -ge '3' ]; then
		result=`~/projects/cs219_ccnumr/bin/ccnumrd $3`
	else
		result=`~/projects/cs219_ccnumr/bin/ccnumrd`
	fi

elif [ "$arg" = 'stop' ]; then
	echo " * Shutting down ccnud"
	killall ccnud
	echo " * Shutting down ccnumrd"
	killall ccnumrd
fi
